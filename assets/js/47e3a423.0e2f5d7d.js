"use strict";(self.webpackChunkvn_2023_no_2_github_io=self.webpackChunkvn_2023_no_2_github_io||[]).push([[2467],{1153:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>h});var c=t(5893),s=t(1151);const r={sidebar_position:1},i="C\xe1c chi\u1ebfn l\u01b0\u1ee3c deploy trong Kubernetes",o={id:"IT/kubernetes/kubernetes",title:"C\xe1c chi\u1ebfn l\u01b0\u1ee3c deploy trong Kubernetes",description:"C\xf3 hai strategy c\u01a1 b\u1ea3n th\u01b0\u1eddng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng - \u0111\xe2y l\xe0 c\xe1c strategy \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 khi config qua YAML file trong K8S:",source:"@site/docs/IT/5-kubernetes/kubernetes.md",sourceDirName:"IT/5-kubernetes",slug:"/IT/kubernetes/kubernetes",permalink:"/docs/IT/kubernetes/kubernetes",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IT/5-kubernetes/kubernetes.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Kubernetes",permalink:"/docs/category/kubernetes"},next:{title:"Metrics",permalink:"/docs/IT/kubernetes/monitor-for-ingress-nginx"}},a={},h=[{value:"kube-state-metrics",id:"kube-state-metrics",level:2},{value:"cAdvisor",id:"cadvisor",level:2}];function l(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"c\xe1c-chi\u1ebfn-l\u01b0\u1ee3c-deploy-trong-kubernetes",children:"C\xe1c chi\u1ebfn l\u01b0\u1ee3c deploy trong Kubernetes"}),"\n",(0,c.jsx)(n.p,{children:"C\xf3 hai strategy c\u01a1 b\u1ea3n th\u01b0\u1eddng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng - \u0111\xe2y l\xe0 c\xe1c strategy \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 khi config qua YAML file trong K8S:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Recreating - Shutdown old version and create a new version."}),"\n",(0,c.jsx)(n.li,{children:"Rolling - Nh\u1eefng version m\u1edbi s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o v\xe0 thay th\u1ebf version c\u0169 m\u1ed9t c\xe1ch t\u1eeb t\u1eeb, t\u1eebng c\xe1i m\u1ed9t (\u0111\xe2y l\xe0 default strategy)."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:'C\xe1c chi\u1ebfn l\u01b0\u1ee3c sau \u0111\xe2y \u0111\u01b0\u1ee3c coi l\xe0 "Chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai n\xe2ng cao" v\xec l\u01b0u l\u01b0\u1ee3ng truy c\u1eadp c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c ki\u1ec3m so\xe1t theo nhi\u1ec1u c\xe1ch kh\xe1c nhau:'}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Blue/Green - Version m\u1edbi s\u1ebd t\u1ed3n t\u1ea1i c\xf9ng v\u1edbi version c\u0169. Nh\u01b0ng end-user kh\xf4ng access v\xe0o version m\u1edbi, ch\u1ec9 QA, tester m\u1edbi s\u1eed d\u1ee5ng version cho m\u1ee5c \u0111\xedch test. Sau khi test kh\xf4ng c\xf3 v\u1ea5n \u0111\u1ec1 g\xec th\xec m\u1edbi chuy\u1ec3n traffic c\u1ee7a end-user qua version m\u1edbi."}),"\n",(0,c.jsx)(n.li,{children:"Canary - Deploy version m\u1edbi cho 1 l\u01b0\u1ee3ng nh\u1ecf end-user, n\u1ebfu kh\xf4ng c\xf3 v\u1ea5n \u0111\u1ec1 th\xec update to\xe0n b\u1ed9."}),"\n",(0,c.jsx)(n.li,{children:"A/B testing - Deploy version m\u1edbi cho 1 l\u01b0\u1ee3ng nh\u1ecf end-user d\u1ef1a v\xe0o \u0111i\u1ec1u ki\u1ec7n nh\u01b0 (HTTP header, cookie, \u2026)"}),"\n",(0,c.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"Reference:"}),(0,c.jsx)(n.br,{}),"\n",(0,c.jsx)(n.a,{href:"https://spacelift.io/blog/kubernetes-deployment-strategies",children:"https://spacelift.io/blog/kubernetes-deployment-strategies"}),(0,c.jsx)(n.br,{}),"\n",(0,c.jsx)(n.a,{href:"https://blog.cloud-ace.vn/cac-chien-luoc-trien-khai-kubernetes/",children:"https://blog.cloud-ace.vn/cac-chien-luoc-trien-khai-kubernetes/"})]}),"\n",(0,c.jsx)(n.h1,{id:"hpa",children:"HPA"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"HPA sclale theo gi\xe1 tr\u1ecb s\u1eed d\u1ee5ng trung b\xecnh c\u1ee7a pod \u0111\u1ec3 duy tr\xec m\u1ee9c s\u1eed d\u1ee5ng resource trung b\xecnh theo target."}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: demo\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: demo\n  minReplicas: 3\n  maxReplicas: 9\n  metrics:\n    - type: Resource\n      resource:\n        name: cpu\n        target:\n          type: Utilization\n          averageUtilization: 50\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"Reference:"}),"\n",(0,c.jsx)(n.a,{href:"https://spacelift.io/blog/kubernetes-hpa-horizontal-pod-autoscaler",children:"https://spacelift.io/blog/kubernetes-hpa-horizontal-pod-autoscaler"})]}),"\n",(0,c.jsx)(n.h1,{id:"service-discovery",children:"Service Discovery"}),"\n",(0,c.jsxs)(n.p,{children:["Service Discovery l\xe0 m\u1ed9t thu\u1eadt ng\u1eef ch\u1ec9 c\xe1ch c\xe1c \u1ee9ng d\u1ee5ng t\u1ef1 \u0111\u1ed9ng ph\xe1t hi\u1ec7n \u0111\u1ecba ch\u1ec9 c\u1ee7a nhau th\xf4ng qua Service.",(0,c.jsx)(n.br,{}),"\n","Service Discovery trong Kubernetes",(0,c.jsx)(n.br,{}),"\n","Ta s\u1ebd c\xf3 hai c\xe1ch sau \u0111\u1ec3 c\xe1c \u1ee9ng d\u1ee5ng trong Pod ph\xe1t hi\u1ec7n \u0111\u01b0\u1ee3c service:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Ph\xe1t hi\u1ec7n th\xf4ng qua bi\u1ebfn m\xf4i tr\u01b0\u1eddng (ENV)"}),"\n",(0,c.jsx)(n.li,{children:"Ph\xe1t hi\u1ec7n th\xf4ng qua DNS Lookup."}),"\n"]}),"\n",(0,c.jsx)(n.h1,{id:"c\xe1c-metrics-c\u1ee7a-c\u1ee5m-k8s-\u0111\u1ebfn-t\u1eeb-\u0111\xe2u",children:"C\xe1c metrics c\u1ee7a c\u1ee5m K8S \u0111\u1ebfn t\u1eeb \u0111\xe2u"}),"\n",(0,c.jsx)(n.h2,{id:"kube-state-metrics",children:"kube-state-metrics"}),"\n",(0,c.jsxs)(n.p,{children:["Kube-state-metrics t\u1ea1o ra c\xe1c metric v\u1ec1 tr\u1ea1ng th\xe1i kubernetes object bao g\u1ed3m cronjob, configmap, pods v\xe0 node t\u1eeb Kubernetes API. C\xf4ng c\u1ee5 n\xe0y cho ch\xfang ta n\u1eafm b\u1eaft t\u1ed5ng th\u1ec3 h\u1ec7 th\u1ed1ng kubernetes v\u1ec1 tr\u1ea1ng th\xe1i, v\xed d\u1ee5: s\u1ed1 l\u01b0\u1ee3ng mong mu\u1ed1n pod replicas cho 1 deployment ho\u1eb7c t\u1ed5ng s\u1ed1 l\u01b0\u1ee3ng CPU c\xf2n s\u1eb5n tr\xean 1 node.",(0,c.jsx)(n.br,{}),"\n","\u0110\xe2y l\xe0 m\u1ed9t resource \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\xean k8s, expose \u1edf ",(0,c.jsx)(n.code,{children:"http://service-name:8080/metrics"}),(0,c.jsx)(n.br,{}),"\n","M\u1ed9t s\u1ed1 metrics"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"kube_pod_status_phase\nkube_pod_info\nkube_pod_container_status_restarts_total\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cadvisor",children:"cAdvisor"}),"\n",(0,c.jsx)(n.p,{children:"cAdvisor \u0111\u01b0\u1ee3c embedded trong kubelet, expose \u1edf :10250/metrics/cadvisor, l\xe0 agent ph\xe2n t\xedch hi\u1ec7u su\u1ea5t v\xe0 s\u1eed d\u1ee5ng t\xe0i nguy\xean c\u1ee7a container, n\xf3 \u0111\u01b0\u1ee3c t\xedch h\u1ee3p trong kubelet. cAdvisor auto-discover t\u1ea5t c\u1ea3 container trong docker host v\xe0 th\u1ed1ng k\xea v\u1ec1 memory, network, filesystem, CPU.\nM\u1ed9t s\u1ed1 metrics"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"container_cpu_usage_seconds_total\n"})}),"\n",(0,c.jsx)(n.p,{children:"..."}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"Reference:"}),(0,c.jsx)(n.br,{}),"\n",(0,c.jsx)(n.a,{href:"https://lazyadmin.vn/cac-cong-cu-giam-sat-he-thong-kubernetes/",children:"https://lazyadmin.vn/cac-cong-cu-giam-sat-he-thong-kubernetes/"})]})]})}function d(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>i});var c=t(7294);const s={},r=c.createContext(s);function i(e){const n=c.useContext(r);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);