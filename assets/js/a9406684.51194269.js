"use strict";(self.webpackChunkvn_2023_no_2_github_io=self.webpackChunkvn_2023_no_2_github_io||[]).push([[2917],{8453:(n,t,e)=>{e.d(t,{R:()=>s,x:()=>a});var i=e(6540);const h={},c=i.createContext(h);function s(n){const t=i.useContext(c);return i.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function a(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(h):n.components||h:s(n.components),i.createElement(c.Provider,{value:t},n.children)}},8961:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>d,frontMatter:()=>c,metadata:()=>a,toc:()=>o});var i=e(4848),h=e(8453);const c={sidebar_position:1},s="T\u1ea3n m\u1ea1n",a={id:"IT/other/rambling",title:"T\u1ea3n m\u1ea1n",description:"Concept System Design",source:"@site/docs/IT/100-other/100-rambling.md",sourceDirName:"IT/100-other",slug:"/IT/other/rambling",permalink:"/docs/IT/other/rambling",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IT/100-other/100-rambling.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"ArgoCD",permalink:"/docs/IT/other/argocd"},next:{title:"RabbitMQ",permalink:"/docs/IT/other/rabbitmq"}},r={},o=[{value:"Concept System Design",id:"concept-system-design",level:2},{value:"Database",id:"database",level:3},{value:"Sharding",id:"sharding",level:4},{value:"Consistency",id:"consistency",level:4},{value:"C\xe2u chuy\u1ec7n \u0111\xe1nh \u0111\u1ed5i gi\u1eefa t\xednh consistency v\xe0 high availability",id:"c\xe2u-chuy\u1ec7n-\u0111\xe1nh-\u0111\u1ed5i-gi\u1eefa-t\xednh-consistency-v\xe0-high-availability",level:4}];function l(n){const t={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,h.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"t\u1ea3n-m\u1ea1n",children:"T\u1ea3n m\u1ea1n"}),"\n",(0,i.jsx)(t.h2,{id:"concept-system-design",children:"Concept System Design"}),"\n",(0,i.jsx)(t.h3,{id:"database",children:"Database"}),"\n",(0,i.jsx)(t.p,{children:"M\u1ed9t Database Transaction, theo nh\u01b0 \u0111\u1ecbnh ngh\u0129a s\u1ebd ph\u1ea3i th\u1ecfa m\xe3n c\xe1c t\xednh ch\u1ea5t sau: Atomic, Consistency, Isolation v\xe0 Durable (hay th\u01b0\u1eddng \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 ACID). B\xe0i vi\u1ebft n\xe0y s\u1ebd t\u1eadp trung v\xe0o t\xednh ch\u1ea5t Consistency."}),"\n",(0,i.jsx)(t.h4,{id:"sharding",children:"Sharding"}),"\n",(0,i.jsx)(t.p,{children:"C\xe1ch t\xe1ch database v\xe0 l\u01b0u tr\u1eef, c\xf3 th\u1ec3 t\xe1ch th\xe0nh 4 con server nh\u01b0 sau:"}),"\n",(0,i.jsx)(t.p,{children:"Database 1: l\u01b0u c\xe1c users c\xf3 ID chia cho 4 d\u01b0 1 (mod). V\xed d\u1ee5 1, 5, 9, 13, \u2026\nDatabase 2: l\u01b0u c\xe1c users c\xf3 ID chia cho 4 d\u01b0 2. V\xed d\u1ee5 2, 6, 10, 14, \u2026\nDatabase 3: l\u01b0u c\xe1c users c\xf3 ID chia cho 4 d\u01b0 3. V\xed d\u1ee5 3, 7, 11, 15, \u2026\nDatabase 4: l\u01b0u c\xe1c users c\xf3 ID chia cho 4 d\u01b0 0. V\xed d\u1ee5 4, 8, 12, 16, \u2026\nB\xe2y gi\u1edd, v\u1ea5n \u0111\u1ec1 l\xe0m sao \u0111\u1ec3 generate ID cho user khi h\u1ecd register \u0111\xe2y ta? L\xe0m sao bi\u1ebft user n\xe0o l\u01b0u v\xe0o database n\xe0o? \u0110\xe2y l\xe0 ID Generator \u1edf trong h\xecnh \u0111\xf3 b\u1ea1n"}),"\n",(0,i.jsx)(t.p,{children:"B\u1ea1n l\u1ea1i tr\u1eb1n tr\u1ecdc suy ngh\u0129, v\xec b\u1ea1n l\xe0 thi\xean t\xe0i n\xean sau 1 \u0111\xeam b\u1ea1n \u0111\xe3 suy ngh\u0129 ra l\xe0. \xc0 hay l\xe0 m\xecnh t\u1ea1o ra m\u1ed9t hash function \u0111\u1ec3 hash user email l\u1ea1i v\xe0 generate ID ra ta."}),"\n",(0,i.jsx)(t.p,{children:"V\xe0 \xfd t\u01b0\u1edfng c\u1ee7a b\u1ea1n nh\u01b0 sau (code d\u01b0\u1edbi l\xe0 v\xed d\u1ee5 th\xf4i nhoa):"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-Java",children:'class IdGenerator {\n    // Method n\xe0y d\xf9ng \u0111\u1ec3 sinh ra m\u1ed9t unique ID \u1ee9ng v\u1edbi email c\u1ee7a user.\n    public static int generateUserId(String email) \n                                    throws NoSuchAlgorithmException {\n        MessageDigest digest = MessageDigest.getInstance("SHA-256");\n        byte[] hashBytes = digest.digest(\n                               email.getBytes(StandardCharsets.UTF_8));\n        \n        return Math.abs(new BigInteger(1, hashBytes).intValue());\n    }\n\n    // Method n\xe0y d\xf9ng \u0111\u1ec3 get server ID. \n    // T\u1eeb \u0111\xf3 s\u1ebd bi\u1ebft user n\xe0o c\u1ea7n \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef \u1edf \u0111\xe2u.\n    public static int generateServerId(int userId) {\n        return userId % 4;\n    }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"B\xe2y gi\u1edd khi user \u0111\u0103ng k\xfd t\xe0i kho\u1ea3n, b\u1ea1n ch\u1ec9 c\u1ea7n l\u1ea5y email c\u1ee7a user r\u1ed3i \u0111\u01b0a v\xe0o IdGenerator l\xe0 xong."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-Java",children:'// Gi\u1ea3 s\u1eed email \u0111ang l\xe0 "anhLiem@gmail.com";\nint userId = IdGenerator.generateUserId(email); // K\u1ebft qu\u1ea3 ra 16129187\nint serverId = IdGenerator.generateServerId(userId); // K\u1ebft qu\u1ea3 ra 3\n'})}),"\n",(0,i.jsx)(t.p,{children:"V\u1eady l\xe0 b\u1ea1n \u0111\xe3 bi\u1ebft anh Li\xeam l\u01b0u \u1edf server th\u1ee9 3."}),"\n",(0,i.jsx)(t.h4,{id:"consistency",children:"Consistency"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"Distributed Database"})," (h\u1ec7 th\u1ed1ng c\u01a1 s\u1edf d\u1eef li\u1ec7u ph\xe2n t\xe1n): L\xe0 h\u1ec7 th\u1ed1ng C\u01a1 s\u1edf d\u1eef li\u1ec7u (CSDL) m\xe0 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c ph\xe2n t\u1ea3i, l\u01b0u tr\u1eef \u1edf nhi\u1ec1u n\u01a1i."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"Strong Consistency"})," (t\xednh nh\u1ea5t qu\xe1n m\u1ea1nh): M\u1ed9t c\u1eadp nh\u1eadt \u0111\u01b0\u1ee3c di\u1ec5n ra v\xe0 tr\u1ea3 v\u1ec1 tr\u1ea1ng th\xe1i success khi c\xe1c node trong distributed database \u0111\u1ec1u \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt.",(0,i.jsx)(t.br,{}),"\n","V\xed d\u1ee5: Khi m\u1ed9t \xf4ng user A n\xe0o \u0111\xf3 th\u1ef1c hi\u1ec7n ghi d\u1eef li\u1ec7u (tr\xean h\xecnh l\xe0 ghi X=100 v\xe0o node 1). V\xe0 \xf4ng A n\xe0y th\u1ea5y l\u1ec7nh ghi d\u1eef li\u1ec7u th\xe0nh c\xf4ng (v\xed d\u1ee5 response 200 OK). Th\xec ngay l\u1eadp t\u1ee9c c\xf3 2 \xf4ng B v\xe0 C \u0111\u1ecdc d\u1eef li\u1ec7u X ngay \u1edf node 2 v\xe0 node 3. V\xe0 h\u1ecd th\u1ea5y X=100 lu\xf4n. \u0110\xe2y ch\xednh l\xe0 strong consistency. D\u1eef li\u1ec7u \u0111\u01b0\u1ee3c sync \u0111\u1ed3ng b\u1ed9 qua c\xe1c node. Kh\xf4ng c\xf3 chuy\u1ec7n l\xe0 \xf4ng A ghi th\xe0nh c\xf4ng r\u1ed3i, v\xe0 \xf4ng C get X ra th\xec not found."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"Eventual Consistency"})," (t\xednh nh\u1ea5t qu\xe1n cu\u1ed1i c\xf9ng, l\xe0 m\u1ed9t d\u1ea1ng c\u1ee7a t\xednh nh\u1ea5t qu\xe1n y\u1ebfu - Weak Consistency): Sau khi m\u1ed9t c\u1eadp nh\u1eadt \u0111\u01b0\u1ee3c di\u1ec5n ra, c\xe1c l\u1ea7n \u0111\u1ecdc sau \u0111\xf3 kh\xf4ng \u0111\u1ea3m b\u1ea3o s\u1ebd lu\xf4n tr\u1ea3 v\u1ec1 gi\xe1 tr\u1ecb m\u1edbi \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt (c\xf3 th\u1ec3 c\xf3 l\u1ea7n \u0111\u1ecdc v\u1eabn tr\u1ea3 v\u1ec1 d\u1eef li\u1ec7u c\u0169). Tuy nhi\xean sau m\u1ed9t kho\u1ea3ng th\u1eddi gian (\u0111\u1ed3ng b\u1ed9 gi\u1eefa c\xe1c CSDL) th\xec cu\u1ed1i c\xf9ng c\xe1c l\u1ea7n \u0111\u1ecdc \u0111\u1ec1u tr\u1ea3 v\u1ec1 gi\xe1 tr\u1ecb m\u1edbi nh\u1ea5t.",(0,i.jsx)(t.br,{}),"\n","V\xed d\u1ee5: Trong b\u1ed1i c\u1ea3nh m\u1edbi n\xe0y, X=100 \u0111\xe3 \u0111\u01b0\u1ee3c ghi th\xe0nh c\xf4ng \u1edf node 1. Sau \u0111\xf3 \u0111\u01b0\u1ee3c sync ngay qua node 2 v\xe0 node 3. V\xe0 l\xfac n\xe0y \xf4ng B \u0111\u1ecdc node 2 th\xec th\u1ea5y k\u1ebft qu\u1ea3 100. Nh\u01b0ng \xf4ng C \u0111\u1ecdc node 3 th\xec not found. V\xe0 \xf4ng B th\u1ea5y l\u1ea1 li\u1ec1n g\u1ecdi \u0111i\u1ec7n ch\u1eedi \xf4ng A, ch\xfa l\u01b0u d\u1eef li\u1ec7u ch\u01b0a sao anh kh\xf4ng t\xecm th\u1ea5y? \xd4ng A n\xf3i, \u1ee7a anh em m\u1edbi l\u01b0u xong r\u1ed3i \u0111\xf3, anh check l\u1ea1i d\xf9m em. Th\u1ebf l\xe0 \xf4ng B lay hoay refresh l\u1ea1i th\xec th\u1ea5y k\u1ebft qu\u1ea3 100."]}),"\n",(0,i.jsx)(t.h4,{id:"c\xe2u-chuy\u1ec7n-\u0111\xe1nh-\u0111\u1ed5i-gi\u1eefa-t\xednh-consistency-v\xe0-high-availability",children:"C\xe2u chuy\u1ec7n \u0111\xe1nh \u0111\u1ed5i gi\u1eefa t\xednh consistency v\xe0 high availability"}),"\n",(0,i.jsx)(t.p,{children:"Trong th\u1ebf gi\u1edbi distributed database, m\u1ecdi th\u1ee9 kh\xf4ng bao gi\u1edd l\xe0 ho\xe0n h\u1ea3o. B\u1ea3n th\xe2n c\xe1c b\u1ea1n l\xe0 software engineer. V\xe0 nhi\u1ec7m v\u1ee5 c\u1ee7a c\xe1c b\u1ea1n l\xe0 ph\xe2n t\xedch nghi\u1ec7p v\u1ee5 c\u1ee7a s\u1ea3n ph\u1ea9m m\xecnh \u0111ang ph\xe1t tri\u1ec3n v\xe0 gi\u1ea3i quy\u1ebft c\xe1c b\xe0i to\xe1n trade-off n\xe0y."}),"\n",(0,i.jsx)(t.p,{children:"Trong ph\u1ea7n n\xe0y, m\xecnh s\u1ebd c\xf9ng b\u1ea1n \u0111i gi\u1ea3i quy\u1ebft b\xe0i to\xe1n \u0111\xe1nh \u0111\u1ed5i gi\u1eefa availability v\xe0 consistency."}),"\n",(0,i.jsx)(t.p,{children:"C\xf3 b\u1ea1n s\u1ebd th\u1eafc m\u1eafc! Th\u1ebf t\u1ea1i sao ch\xfang ta kh\xf4ng ch\u1ecdn c\u1ea3 2 \xf4ng availability v\xe0 consistency lu\xf4n? M\xe0 ph\u1ea3i \u0111\u1eafn \u0111o suy ngh\u0129 \u0111\u1ec3 l\u1ef1a ch\u1ecdn m\u1ed9t trong hai?"}),"\n",(0,i.jsx)(t.p,{children:"C\xf9ng quay l\u1ea1i b\xe0i to\xe1n strong consistency h\u1ed3i n\u1ea3y x\xedu!"}),"\n",(0,i.jsx)(t.p,{children:"Nh\xecn v\xe0o sequence diagram, b\u1ea1n s\u1ebd th\u1ea5y, l\u1ec7nh write \u0111\u1ec3 th\xe0nh c\xf4ng \u0111\u01b0\u1ee3c \u0111\xf2i h\u1ecfi t\u1ea5t c\u1ea3 c\xe1c node ph\u1ea3i th\xe0nh c\xf4ng. Ngh\u0129a l\xe0 client l\xfac n\xe0y ph\u1ea3i ch\u1edd \u0111\u1ec3 write 3 node. L\xfac n\xe0y latency (th\u1eddi gian response) c\u1ee7a request write X s\u1ebd cao h\u01a1n r\u1ea5t nhi\u1ec1u. V\u1eady th\xec n\u1ebfu nhi\u1ec1u request h\xe0ng lo\u1ea1t \u1eadp t\u1edbi, kh\u1ea3 n\u0103ng c\xe1c node s\u1ebd t\u1ea1ch cao h\u01a1n r\u1ea5t nhi\u1ec1u. V\xe0 k\u1ebft qu\u1ea3 d\u1eabn t\u1edbi low availability."}),"\n",(0,i.jsx)(t.p,{children:"Ch\u1ed1t l\u1ea1i l\xe0. Mu\u1ed1n strong consistency th\xec ph\u1ea3i \u0111\xe1nh \u0111\u1ed5i b\u1edfi availability."}),"\n",(0,i.jsx)(t.p,{children:"Ti\u1ebfp t\u1ee5c v\u1edbi b\xe0i to\xe1n eventual consistency. Latency c\u1ee7a request write X l\xfac n\xe0y r\u1ea5t nh\u1ecf. V\xec ch\u1ec9 c\u1ea7n ghi th\xe0nh c\xf4ng node 1 l\xe0 coi nh\u01b0 request th\xe0nh c\xf4ng. C\xf3 th\u1ec3 hi\u1ec3u \u0111\u01a1n gi\u1ea3n latency l\xfac n\u1ea3y gi\u1ea3m t\u1ed1i thi\u1ec3u g\u1ea5p 3 l\u1ea7n so v\u1edbi tr\u01b0\u1eddng h\u1ee3p strong consistency. Latency nh\u1ecf d\u1eabn t\u1edbi c\xe1c node s\u1ebd ch\u1ecbu t\u1ea3i \u0111\u01b0\u1ee3c nhi\u1ec1u h\u01a1n (high availability). Nh\u01b0ng l\xfac n\xe0y \u0111\xe1nh \u0111\u1ed5i b\u1edfi consistency. Data s\u1ebd \u0111\u01b0\u1ee3c sync qua c\xe1c node t\u1ed1n m\u1ed9t th\u1eddi gian nh\u1ea5t \u0111\u1ecbnh. Cho n\xean \u0111\xf4i khi client read X s\u1ebd ch\u1ec9 th\u1ea5y \u0111\u01b0\u1ee3c data c\u0169. V\xe0 \u0111\xf4i khi kh\xf4ng sync \u0111\u01b0\u1ee3c data qua c\xe1c node d\u1eabn t\u1edbi t\xecnh tr\u1ea1ng inconsistency."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"Ch\u1ed1t l\u1ea1i l\xe0. Mu\u1ed1n high availability th\xec ph\u1ea3i \u0111\xe1nh \u0111\u1ed5i v\u1edbi consistency."})}),"\n",(0,i.jsx)(t.p,{children:"\u0110\xe2y c\u0169ng ch\xednh CAP theorem huy\u1ec1n tho\u1ea1i m\xe0 ch\xfang ta hay nghe th\u1ea5y."}),"\n",(0,i.jsx)(t.p,{children:"V\u1eady th\xec, \u0111\u1ed1i v\u1edbi t\u1eebng business c\u1ee5 th\u1ec3, ch\xfang ta s\u1ebd ph\u1ea3i suy ngh\u0129 v\xe0 l\u1ef1a ch\u1ecdn trade-off \u1edf \u0111\xe2y."}),"\n",(0,i.jsx)(t.p,{children:"M\xecnh l\u1ea5y v\xed d\u1ee5, m\u1ed9t trang social hay b\xe1o \u0111i\u1ec7n t\u1eed (nh\u01b0 24h ch\u1eb3ng h\u1ea1n). C\xf3 th\u1ec3 ch\u1ecdn high availability thay v\xec ch\u1ecdn strong consistency. Nh\u1eefng business li\xean quan t\u1edbi ti\u1ec1n b\u1ea1c th\xec c\xf3 th\u1ec3 ch\u1ecdn strong consistency. T\xfam l\u1ea1i l\xe0 t\xf9y thu\u1ed9c v\xe0o business c\u1ee7a t\u1eebng application c\u1ee5 th\u1ec3. B\u1ea1n v\xe0 team b\u1ea1n s\u1ebd ph\u1ea3i planning v\xe0 l\u1ef1a ch\u1ecdn."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"Reference:"}),(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.a,{href:"https://tech.cybozu.vn/su-khoi-dau-cho-system-design-nang-tam-backend-developer-phan-1-f631d/",children:"https://tech.cybozu.vn/su-khoi-dau-cho-system-design-nang-tam-backend-developer-phan-1-f631d/"}),"\n",(0,i.jsx)(t.a,{href:"https://tech.cybozu.vn/su-khoi-dau-cho-system-design-nang-tam-backend-developer-phan-2-84974/",children:"https://tech.cybozu.vn/su-khoi-dau-cho-system-design-nang-tam-backend-developer-phan-2-84974/"})]})]})}function d(n={}){const{wrapper:t}={...(0,h.R)(),...n.components};return t?(0,i.jsx)(t,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}}}]);