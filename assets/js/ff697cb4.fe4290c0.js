"use strict";(self.webpackChunkvn_2023_no_2_github_io=self.webpackChunkvn_2023_no_2_github_io||[]).push([[1680],{8209:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>h});var s=n(5893),r=n(1151);const o={sidebar_position:1},i="Operators",c={id:"IT/prom-stack/prometheus",title:"Operators",description:"on (instance, job) group_left (version, commit) - this is Prometheus equivalent of a left join from SQL. It uses the instance and job labels, which are automatically added by Prometheus, to group join time series. It\u2019s then going to add the version and commit labels from the time series on the right to the series on the left.",source:"@site/docs/IT/8-prom-stack/prometheus.md",sourceDirName:"IT/8-prom-stack",slug:"/IT/prom-stack/prometheus",permalink:"/docs/IT/prom-stack/prometheus",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IT/8-prom-stack/prometheus.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Prom-stack",permalink:"/docs/category/prom-stack"},next:{title:"nginx",permalink:"/docs/category/nginx"}},a={},h=[{value:"Counter",id:"counter",level:2},{value:"Gauge",id:"gauge",level:2},{value:"Histogram",id:"histogram",level:2},{value:"Summary",id:"summary",level:2}];function u(e){const t={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"operators",children:"Operators"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"on (instance, job) group_left (version, commit)"})," - this is Prometheus equivalent of a left join from SQL. It uses the instance and job labels, which are automatically added by Prometheus, to group join time series. It\u2019s then going to add the version and commit labels from the time series on the right to the series on the left."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"References:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/querying/operators/",children:"https://prometheus.io/docs/prometheus/latest/querying/operators/"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://autometrics.dev/blog/inside-some-complex-prometheus-queries",children:"https://autometrics.dev/blog/inside-some-complex-prometheus-queries"})]}),"\n",(0,s.jsx)(t.h1,{id:"functions",children:"Functions"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"increase"})," function - t\xednh to\xe1n t\u1ed1c \u0111\u1ed9 thay \u0111\u1ed5i c\u1ee7a metric.\n",(0,s.jsx)(t.code,{children:"rate"})," function - t\xednh to\xe1n t\u1ed1c \u0111\u1ed9 thay \u0111\u1ed5i ",(0,s.jsx)(t.code,{children:"theo gi\xe2y"})," c\u1ee7a metric."]}),"\n",(0,s.jsx)(t.p,{children:"B\u1ea3ng s\u1ed1 li\u1ec7u m\u1eabu"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"Time Count increase  rate(count[1m])\n15s  4381  0          0\n30s  4381  0          0\n45s  4381  0          0\n1m   4381  0          0\n\n15s  4381  0          0\n30s  4402  21         0.700023\n45s  4402  0          0.700023\n2m   4423  21         0.7\n\n15s  4423  0          0.7\n30s  4440  17         0.56666666\n45s  4440  0          0.56666666\n3m   4456  16         0.53333333\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"increase[30s] = count at 2m - count at 1.5m = 4423 - 4402 = 21   \nrate[1m]      = (count at 2m - count at 1m) / 60 = (4423 - 4381) / 60 = 0.7\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"H\xe0m `increase` v\xe0 `rate` s\u1ebd tr\u1ea3 v\u1ec1 k\u1ebft qu\u1ea3 `Empty query result` n\u1ebfu trong kho\u1ea3ng th\u1eddi gian [t] metric [c] kh\xf4ng bao ph\u1ee7 \xedt nh\u1ea5t 2 samples. V\xec v\u1eady h\xe3y xem x\xe9t t\u0103ng kho\u1ea3ng th\u1eddi gian l\xean \u0111\u1ec3 c\xf3 th\u1ec3 t\xednh to\xe1n \u0111\u01b0\u1ee3c.   \n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"Reference:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/querying/functions/",children:"https://prometheus.io/docs/prometheus/latest/querying/functions/"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://stackoverflow.com/a/71662506/14312225",children:"https://stackoverflow.com/a/71662506/14312225"})]}),"\n",(0,s.jsx)(t.h1,{id:"service-discovery",children:"Service Discovery"}),"\n",(0,s.jsx)(t.p,{children:"Service discovery is a fundamental concept in Prometheus architecture. It allows Prometheus to automatically discover and monitor targets (systems or services) without requiring manual configuration for each individual target."}),"\n",(0,s.jsx)(t.p,{children:"Kubernetes is the perfect example for dynamic targets. Here, you cannot use the static targets method, because targets (pods) in a Kubernetes cluster is ephemeral in nature and could be short lived."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"scrape_configs:\n    - job_name: 'kubernetes-apiservers'\n    kubernetes_sd_configs:\n    - role: endpoints\n    scheme: https\n    tls_config:\n        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n    relabel_configs:\n    - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]\n        action: keep\n        regex: default;kubernetes;https\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"Reference:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://medium.com/@tech_18484/understand-prometheus-architecture-1ab83afd53b8",children:"https://medium.com/@tech_18484/understand-prometheus-architecture-1ab83afd53b8"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://devopscube.com/prometheus-architecture/",children:"https://devopscube.com/prometheus-architecture/"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://devalpharm.medium.com/deploying-prometheus-and-grafana-on-kubernetes-using-manifest-files-3761792d12a4",children:"https://devalpharm.medium.com/deploying-prometheus-and-grafana-on-kubernetes-using-manifest-files-3761792d12a4"})]}),"\n",(0,s.jsx)(t.h1,{id:"metric-types-4-lo\u1ea1i",children:"Metric types (4 lo\u1ea1i)"}),"\n",(0,s.jsx)(t.h2,{id:"counter",children:"Counter"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Kh\xf4ng d\xf9ng cho c\xe1c metric c\xf3 th\u1ec3 gi\u1ea3m theo th\u1eddi gian."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"gauge",children:"Gauge"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"D\xf9ng cho c\xe1c metric c\xf3 th\u1ec3 t\u0103ng ho\u1eb7c gi\u1ea3m theo th\u1eddi gian."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"histogram",children:"Histogram"}),"\n",(0,s.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"Reference:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/concepts/metric_types/",children:"https://prometheus.io/docs/concepts/metric_types/"})]})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>c,a:()=>i});var s=n(7294);const r={},o=s.createContext(r);function i(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);