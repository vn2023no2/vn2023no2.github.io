"use strict";(self.webpackChunkvn_2023_no_2_github_io=self.webpackChunkvn_2023_no_2_github_io||[]).push([[105],{8448:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>h,contentTitle:()=>i,default:()=>l,frontMatter:()=>r,metadata:()=>o,toc:()=>a});var t=c(5893),s=c(1151);const r={sidebar_position:3},i="Authentication",o={id:"IT/kubernetes/service-account-rbac",title:"service-account-rbac",description:"Authentication (x\xe1c th\u1ef1c) ==> S\u1eed d\u1ee5ng Service Account (authentication qua token, \u0111\xe2y l\xe0 c\xe1ch authentication duy nh\u1ea5t \u0111\u01b0\u1ee3c qu\u1ea3n l\xfd b\u1edfi K8S) ho\u1eb7c c\xf3 th\u1ec3 d\xf9ng c\xe1c external service \u0111\u1ec3 x\xe1c th\u1ef1c v\u1edbi K8S Cluster.",source:"@site/docs/IT/5-kubernetes/service-account-rbac.md",sourceDirName:"IT/5-kubernetes",slug:"/IT/kubernetes/service-account-rbac",permalink:"/docs/IT/kubernetes/service-account-rbac",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IT/5-kubernetes/service-account-rbac.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Metrics",permalink:"/docs/IT/kubernetes/monitor-for-ingress-nginx"},next:{title:"1. Stiky session?",permalink:"/docs/IT/kubernetes/sticky-session"}},h={},a=[{value:"Service Account",id:"service-account",level:2},{value:"Action",id:"action",level:2},{value:"C\xe1c resource \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a RBAC",id:"c\xe1c-resource-\u0111\u1ec3-\u0111\u1ecbnh-ngh\u0129a-rbac",level:2},{value:"V\xed d\u1ee5 v\u1ec1 vi\u1ec7c s\u1eed d\u1ee5ng ServiceAccount, Roles, RoleBindings \u0111\u1ec3 t\u1ea1o user trong K8S",id:"v\xed-d\u1ee5-v\u1ec1-vi\u1ec7c-s\u1eed-d\u1ee5ng-serviceaccount-roles-rolebindings-\u0111\u1ec3-t\u1ea1o-user-trong-k8s",level:3}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Authentication (x\xe1c th\u1ef1c) ==> S\u1eed d\u1ee5ng Service Account (authentication qua token, \u0111\xe2y l\xe0 c\xe1ch authentication duy nh\u1ea5t \u0111\u01b0\u1ee3c qu\u1ea3n l\xfd b\u1edfi K8S) ho\u1eb7c c\xf3 th\u1ec3 d\xf9ng c\xe1c ",(0,t.jsx)(n.code,{children:"external service"})," \u0111\u1ec3 x\xe1c th\u1ef1c v\u1edbi K8S Cluster.",(0,t.jsx)(n.br,{}),"\n","Authorization (ph\xe2n quy\u1ec1n)  ==> S\u1eed d\u1ee5ng RBAC (Role Based Access Control)."]}),"\n",(0,t.jsx)(n.h1,{id:"authentication",children:"Authentication"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"2 lo\u1ea1i user   ==> normal user                  ==> kubectl      \n                  (humans user)                ==> HTTP Request v\u1edbi token    \n\n              ==> service account user         ==> Service Account\n                  (d\xf9ng cho Pod)      \n"})}),"\n",(0,t.jsxs)(n.p,{children:["Ch\xfang ta c\u1ea7n ph\xe2n bi\u1ec7t 2 lo\u1ea1i user \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong k8s ",(0,t.jsx)(n.code,{children:"service account user"})," v\xe0 ",(0,t.jsx)(n.code,{children:"normal user"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"normal user: \u0111\u1ea1i di\u1ec7n cho user c\u1ee7a ng\u01b0\u1eddi d\xf9ng, x\xe1c th\u1ef1c v\u1edbi K8S Cluster b\u1eb1ng d\u1ecbch v\u1ee5 b\xean ngo\xe0i (c\xf3 th\u1ec3 x\xe1c th\u1ef1c b\u1eb1ng private key, username v\xe0 password, OAuth service, ...)"}),"\n",(0,t.jsxs)(n.li,{children:["service account: th\u01b0\u1eddng d\xf9ng cho process ch\u1ea1y trong pod. D\xf9ng resource ",(0,t.jsx)(n.code,{children:"service account"})," c\u1ee7a k8s \u0111\u1ec3 authentication - \u0111\xe2y l\xe0 d\u1ecbch v\u1ee5 authentication \u0111\u01b0\u1ee3c cung c\u1ea5p b\u1edfi K8S v\xe0 x\xe1c th\u1ef1c b\u1eb1ng token."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["L\u01b0u \xfd: C\xf3 th\u1ec3 m\u1ecdi ng\u01b0\u1eddi kh\xf4ng \u0111\u1ed3ng \xfd s\u1eed d\u1ee5ng ",(0,t.jsx)(n.code,{children:"Service Account resource"})," cho ",(0,t.jsx)(n.code,{children:"normal user"}),", nh\u01b0ng ch\u01b0a th\u1ea5y b\u1ea5t k\u1ef3 t\xe0i li\u1ec7u n\xe0o c\u1ee7a K8S vi\u1ebft r\u1eb1ng kh\xf4ng n\xean s\u1eed d\u1ee5ng cho ",(0,t.jsx)(n.code,{children:"normal user"}),". V\xec v\u1eady, t\xf4i ngh\u0129 ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ",(0,t.jsx)(n.code,{children:"Service Account resource"})," \u0111\u1ec3 t\u1ea1o user cho vi\u1ec7c s\u1eed d\u1ee5ng ",(0,t.jsx)(n.code,{children:"kubectl"})," ho\u1eb7c ",(0,t.jsx)(n.code,{children:"HTTP Request"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["C\u1ea3 ",(0,t.jsx)(n.code,{children:"normal user"})," v\xe0 ",(0,t.jsx)(n.code,{children:"service account user"})," \u0111\u1ec1u ph\u1ea3i thu\u1ed9c m\u1ed9t ho\u1eb7c nhi\u1ec1u group. C\xf3 4 lo\u1ea1i group m\u1eb7c \u0111\u1ecbnh l\xe0"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["system",":unauthenticated"," - \u0111\u01b0\u1ee3c g\xe1n cho user kh\xf4ng authenticated th\xe0nh c\xf4ng."]}),"\n",(0,t.jsxs)(n.li,{children:["system",":authenticated"," - \u0111\u01b0\u1ee3c g\xe1n cho user authenticated th\xe0nh c\xf4ng."]}),"\n",(0,t.jsxs)(n.li,{children:["system",":serviceaccounts"," - group cho to\xe0n b\u1ed9 ServiceAccounts."]}),"\n",(0,t.jsx)(n.li,{children:"system:serviceaccounts:<namespace>  - group cho to\xe0n b\u1ed9 ServiceAccounts trong m\u1ed9t namespace."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"service-account",children:"Service Account"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Service Account l\xe0 m\u1ed9t resource c\u1ee7a k8s."}),"\n",(0,t.jsx)(n.li,{children:"Service Account n\xe0y l\xe0 m\u1ed9t namespace resouce, ngh\u0129a l\xe0 ch\u1ec9 c\xf3 scope b\xean trong m\u1ed9t namespace, ta kh\xf4ng th\u1ec3 d\xf9ng ServiceAccount c\u1ee7a namespace n\xe0y cho m\u1ed9t namespace kh\xe1c \u0111\u01b0\u1ee3c."}),"\n",(0,t.jsxs)(n.li,{children:["Service Account \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng cho pod s\u1ebd \u0111\u01b0\u1ee3c mount v\xe0o pod \u1edf path ",(0,t.jsx)(n.code,{children:"/var/run/secrets/kubernetes.io/serviceaccount"}),". M\u1eb7c \u0111\u1ecbnh m\u1ed7i namespace \u0111\u1ec1u c\xf3 1 service acocunt l\xe0 ",(0,t.jsx)(n.code,{children:"default"})," v\xe0 khi pod \u0111\u01b0\u1ee3c t\u1ea1o th\xec s\u1ebd s\u1eed d\u1ee5ng service account n\xe0y."]}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"authorization-role-based-access-control",children:"Authorization (Role Based Access Control)"}),"\n",(0,t.jsxs)(n.p,{children:["N\u1ebfu nh\u01b0 service account v\xe0 c\xe1c ",(0,t.jsx)(n.code,{children:"external service"})," ch\u1ec9 d\xf9ng \u0111\u1ec3 authentication th\xec Role Based Access Control trong K8S s\u1ebd gi\xfap ch\xfang ta vi\u1ec7c Authorization cho c\xe1c ",(0,t.jsx)(n.code,{children:"normal user"})," ho\u1eb7c ",(0,t.jsx)(n.code,{children:"service account user"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"action",children:"Action"}),"\n",(0,t.jsx)(n.p,{children:"C\xe1c action c\xf3 th\u1ec3 th\u1ef1c hi\u1ec7n v\u1edbi RBAC th\xec nh\u01b0 sau"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Action"}),(0,t.jsx)(n.th,{children:"Verb"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HEAD, GET"}),(0,t.jsx)(n.td,{children:"get"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:"create"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PUT"}),(0,t.jsx)(n.td,{children:"update"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PATCH"}),(0,t.jsx)(n.td,{children:"patch"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DELETE"}),(0,t.jsx)(n.td,{children:"delete"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"c\xe1c-resource-\u0111\u1ec3-\u0111\u1ecbnh-ngh\u0129a-rbac",children:"C\xe1c resource \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a RBAC"}),"\n",(0,t.jsxs)(n.p,{children:["RBAC c\xf3 4 lo\u1ea1i resources ==> Roles: \u0111\u1ecbnh ngh\u0129a verb n\xe0o c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n l\xean tr\xean namespace resource, s\u1ebd thu\u1ed9c namespace.",(0,t.jsx)(n.br,{}),"\n","==> ClusterRoles: \u0111\u1ecbnh ngh\u0129a verb n\xe0o c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n l\xean tr\xean cluster resource, kh\xf4ng thu\u1ed9c b\u1ea5t k\u1ef3 m\u1ed9t namespace n\xe0o.",(0,t.jsx)(n.br,{}),"\n","==> RoleBindings: g\xe1n Roles t\u1edbi m\u1ed9t Service Account ho\u1eb7c user.",(0,t.jsx)(n.br,{}),"\n","==> ClusterRoleBindings: g\xe1n ClusterRoles t\u1edbi m\u1ed9t Service Account ho\u1eb7c user."]}),"\n",(0,t.jsx)(n.h1,{id:"v\xed-d\u1ee5",children:"V\xed d\u1ee5"}),"\n",(0,t.jsx)(n.h3,{id:"v\xed-d\u1ee5-v\u1ec1-vi\u1ec7c-s\u1eed-d\u1ee5ng-serviceaccount-roles-rolebindings-\u0111\u1ec3-t\u1ea1o-user-trong-k8s",children:"V\xed d\u1ee5 v\u1ec1 vi\u1ec7c s\u1eed d\u1ee5ng ServiceAccount, Roles, RoleBindings \u0111\u1ec3 t\u1ea1o user trong K8S"}),"\n",(0,t.jsx)(n.p,{children:"T\u1ea1o m\u1ed9t Service Account resource"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# ServiceAccount\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: demo-sa\n  namespace: default\n"})}),"\n",(0,t.jsx)(n.p,{children:"Apply v\xe0o K8S"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl apply -f demo-sa.yaml\n"})}),"\n",(0,t.jsxs)(n.p,{children:["T\u1ea1o role\nC\u1ea5u h\xecnh role b\xean d\u01b0\u1edbi cho ph\xe9p th\u1ef1c hi\u1ec7n c\xe1c h\xe0nh \u0111\u1ed9ng ",(0,t.jsx)(n.code,{children:"get, list, create, update"})," \u0111\u1ed1i v\u1edbi pods.\nChi ti\u1ebft:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:['apiGroup: [""] - \u0111i\u1ec1u n\xe0y ngh\u0129a l\xe0 role \xe1p d\u1ee5ng cho c\xe1c t\xe0i nguy\xean ',(0,t.jsx)(n.a,{href:"https://miro.medium.com/v2/resize:fit:1400/1*IqxBLalz8WP4ZJBM8uyx9g.png",children:"core API"})," c\u1ee7a Kubernetes nh\u01b0: pod, service, deployment, ..."]}),"\n",(0,t.jsx)(n.li,{children:"resources: [pods] - ch\u1ec9 \u0111\u1ecbnh c\u1ee5 th\u1ec3 lo\u1ea1i resource m\xe0 role n\xe0y \xe1p d\u1ee5ng l\xe0 pod, n\u1ebfu kh\xf4ng ch\u1ec9 \u0111\u1ecbnh resources th\xec Role s\u1ebd \xe1p d\u1ee5ng cho t\u1ea5t c\u1ea3 resouces trong core API."}),"\n",(0,t.jsx)(n.li,{children:"verbs: [get, list, create, update] - \u0111\u01a1n n\xe0y l\xe0 ch\u1ec9 \u0111\u1ecbnh c\xe1c lo\u1ea1i action m\xe0 role n\xe0y c\xf3 th\u1ec3 s\u1eed d\u1ee5ng."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'# Role\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: demo-role\n  namespace: default\nrules:\n  - apiGroups:\n      - ""\n    resources:\n      - pods\n    verbs:\n      - get\n      - list\n      - create\n      - update\n'})}),"\n",(0,t.jsx)(n.p,{children:"Apply v\xe0o K8S"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl apply -f demo-role.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"T\u1ea1o RoleBinding"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: demo-role-binding\n  namespace: default\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: demo-role\nsubjects:\n  - namespace: default\n    kind: ServiceAccount\n    name: demo-user\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"Apply v\xe0o K8S"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl apply -f demo-role-binding.yaml\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"References:"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://spacelift.io/blog/kubernetes-rbac",children:"https://spacelift.io/blog/kubernetes-rbac"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://www.linkedin.com/pulse/create-user-kubernetes-kubectl-service-account-vikash-kumar-singh",children:"https://www.linkedin.com/pulse/create-user-kubernetes-kubectl-service-account-vikash-kumar-singh"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/",children:"https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/authentication/",children:"https://kubernetes.io/docs/reference/access-authn-authz/authentication/"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://www.strongdm.com/blog/kubernetes-authentication",children:"https://www.strongdm.com/blog/kubernetes-authentication"})]})]})}function l(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,c)=>{c.d(n,{Z:()=>o,a:()=>i});var t=c(7294);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);